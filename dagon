#!/bin/bash

directory="${BASH_SOURCE%/*}"
. "$directory/includes/core.sh"
. "$directory/includes/messages.sh"
. "$directory/includes/requirements.sh"

m.status "\nDagon will do your bidding. Sit back and enjoy...\n"
sleep 0.5 

flag.check folders
if [ $? == 1 ]; then
  m.status "Creating necessary folders. (You will be asked for your sudo password if needed)" 
  sudo mkdir -p "/usr/local/dagon"
  sudo mkdir -p "/usr/local/dagon/roles"
  sudo mkdir -p "/usr/local/dagon/flags"
  sudo chmod -R g+rwx /usr/local
  sudo chgrp -R admin /usr/local
  
  flag.set folders
fi

cd /usr/local/dagon

username=$USER
repository="none so far"
export ANSIBLE_ASK_SUDO_PASS=True
export HOMEBREW_CASK_OPTS="--appdir=/Applications"

requirements.set "eval sleep printf read hash tput dirname easy_install"
  requirements.failure eval abort
  requirements.failure sleep abort
  requirements.failure printf abort
  requirements.failure read abort 
  requirements.failure hash abort
  requirements.failure dirname abort
  requirements.failure easy_install abort
  requirements.failure tput abort
requirements.check

requirements.set "pip ansible"
  requirements.failure pip "sudo easy_install --quiet pip"
  requirements.failure ansible "sudo pip install --quiet ansible"
requirements.check

# m.status "Creating folders"
# sudo mkdir -p /usr/local/dagon
# sudo mkdir -p /usr/local/dagon/roles
# sudo chmod -R g+rwx /usr/local
# sudo chgrp -R admin /usr/local
